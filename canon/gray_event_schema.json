{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://livingmagicks.codex/schemas/gray_event.json",
  "title": "Gray Event Schema",
  "description": "Standard schema for reporting Gray events (adjacency violations, degeneracy, illegal jumps)",
  "type": "object",
  "required": ["type", "index", "timestamp"],
  "properties": {
    "type": {
      "type": "string",
      "enum": [
        "adjacency_violation",
        "degeneracy_detected",
        "unknown_token",
        "entropy_plateau",
        "mimic_loop"
      ],
      "description": "The type of Gray event"
    },
    "index": {
      "type": "integer",
      "minimum": 0,
      "description": "Position in the sequence where the Gray event occurred"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of when the event was detected"
    },
    "from": {
      "type": "integer",
      "minimum": 0,
      "maximum": 6,
      "description": "Source color index (for transition-based events)"
    },
    "to": {
      "type": "integer",
      "minimum": 0,
      "maximum": 6,
      "description": "Target color index (for transition-based events)"
    },
    "delta": {
      "type": "integer",
      "description": "Computed delta: (to - from) mod 7"
    },
    "reason": {
      "type": "string",
      "description": "Human-readable explanation of why this is a Gray event"
    },
    "severity": {
      "type": "string",
      "enum": ["warning", "error", "critical"],
      "default": "error",
      "description": "Severity level of the Gray event"
    },
    "entropy_metrics": {
      "type": "object",
      "description": "Compression/entropy metrics (for degeneracy-based Gray events)",
      "properties": {
        "compression_ratio": {
          "type": "number",
          "minimum": 0,
          "description": "Compression ratio at this point"
        },
        "entropy_estimate": {
          "type": "number",
          "minimum": 0,
          "description": "Shannon entropy estimate"
        },
        "ncd_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Normalized Compression Distance score"
        },
        "degeneracy_threshold": {
          "type": "number",
          "description": "Threshold value that was exceeded"
        }
      }
    },
    "context": {
      "type": "object",
      "description": "Additional contextual information",
      "properties": {
        "sequence_length": {
          "type": "integer",
          "minimum": 0,
          "description": "Total length of the sequence being validated"
        },
        "window": {
          "type": "array",
          "items": {"type": "integer"},
          "description": "Surrounding tokens (for context)"
        },
        "file": {
          "type": "string",
          "description": "Source file path (if applicable)"
        },
        "line": {
          "type": "integer",
          "description": "Line number in source file (if applicable)"
        }
      }
    },
    "metadata": {
      "type": "object",
      "description": "Arbitrary metadata for extensibility",
      "additionalProperties": true
    }
  },
  "examples": [
    {
      "type": "adjacency_violation",
      "index": 42,
      "timestamp": "2025-01-01T12:00:00Z",
      "from": 0,
      "to": 2,
      "delta": 2,
      "reason": "Illegal jump: delta 2 not in [1, 6]",
      "severity": "error",
      "context": {
        "sequence_length": 100,
        "window": [0, 2, 3],
        "file": "test_sequence.txt",
        "line": 5
      }
    },
    {
      "type": "degeneracy_detected",
      "index": 150,
      "timestamp": "2025-01-01T12:01:00Z",
      "reason": "Compression ratio flatlined - mimic loop detected",
      "severity": "warning",
      "entropy_metrics": {
        "compression_ratio": 0.95,
        "entropy_estimate": 0.12,
        "ncd_score": 0.98,
        "degeneracy_threshold": 0.9
      },
      "context": {
        "sequence_length": 200,
        "window": [4, 5, 6, 0, 1, 2, 3, 4, 5, 6]
      }
    },
    {
      "type": "unknown_token",
      "index": 7,
      "timestamp": "2025-01-01T12:02:00Z",
      "reason": "Encountered token 'ðŸŸ£' not in canonical sequence",
      "severity": "error",
      "context": {
        "file": "corrupted.txt",
        "line": 2
      }
    }
  ]
}
